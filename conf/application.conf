# Local Development Configuration
# This config uses the webhook simulator for testing

include "application.conf.example"

# Ensure module is loaded (redundant but explicit)
play.modules.enabled += "modules.OutboxModule"

# Override HTTP endpoints to use local simulator
outbox.http {
  # Point to local simulator instead of external service
  baseUrl = "http://localhost:9000/simulator"

  # Default endpoint - randomly fails 30% of the time
  defaultUrl = "http://localhost:9000/simulator/webhook/default"
  defaultMethod = "POST"

  defaultHeaders {
    "X-Service" = "outbox-local-test"
  }

  # Event-specific routes using simulator
  routes {
    OrderCreated {
      url = "http://localhost:9000/simulator/webhook/orders/created"
      method = "POST"
      timeout = 5 seconds
    }

    OrderStatusUpdated {
      url = "http://localhost:9000/simulator/webhook/orders/status"
      method = "PUT"
      timeout = 5 seconds
    }

    OrderCancelled {
      # Test with endpoint that always succeeds
      url = "http://localhost:9000/simulator/always-succeed"
      method = "POST"
      timeout = 5 seconds
    }
  }
}

outbox {
  pollInterval = 2 seconds
  batchSize = 10
  poolSize = 1
}

simulator {
  failureRate = 0.5  # 50% failure rate
  slowResponseRate = 0.3  # 30% slow responses
  slowResponseDelayMs = 1000  # 1 second delay
}

slick {
  dbs {
    default {
      profile = "slick.jdbc.PostgresProfile$"
      db {
        connectionPool = "HikariCP"
        driver = "org.postgresql.Driver"
        url = "jdbc:postgresql://localhost:5432/outbox_db"
        user = "outbox_user"
        password = "outbox_pass"
        numThreads = 8
        maximumPoolSize = 8
        minimumIdle = 0
      }
    }
  }
}

